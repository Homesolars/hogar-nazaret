<footer class="footer pb-3">
  <div class="content has-text-centered">
    {% assign multilingual_pages = site.pages | where:"lang_ref", page.lang_ref | sort: 'lang' %}
    {% if multilingual_pages.size > 1 %}
      <div class="page-switcher">
        <em>
          {{ site.data.languages[page.lang].switcher }}:
        </em>

        {% for multilingual_page in multilingual_pages %}
          {% if page.lang != multilingual_page.lang %}
            <span class="mr-1">
              <a href="{{ multilingual_page.url | relative_url }}" class="{{ multilingual_page.lang }}">
                {{ site.data.languages[multilingual_page.lang].label }}
              </a>
            </span>
          {% endif %}
        {% endfor %}

        <hr />
      </div>
    {% endif %}

    <!-- We also want to cover a mulitlingual post -->
    {% if page.lang == 'en' %}
      {% assign multilingual_post = site.noticias | where:"lang_ref", page.lang_ref %}
    {% else %}
      {% assign multilingual_post = site.posts | where:"lang_ref", page.lang_ref %}
    {% endif %}

    {% if multilingual_post.size > 0 %}
      <div class="page-switcher">
        <em>
          {{ site.data.languages[page.lang].switcher }}:
        </em>
      </div>

      <span class="mr-1">
        <a href="{{ multilingual_post.first.url | relative_url }}" class="{{ multilingual_post.first.lang }}">
          {{ site.data.languages[multilingual_post.first.lang].label }}
        </a>
      </span>

      <hr />
    {% endif %}

    <!-- We also want to cover a mulitlingual upcoming event -->
    {% if page.lang == 'en' %}
      {% assign multilingual_event = site.proximos_eventos | where:"lang_ref", page.lang_ref %}
    {% else %}
      {% assign multilingual_event = site.upcoming_events | where:"lang_ref", page.lang_ref %}
    {% endif %}

    {% if multilingual_event.size > 0 %}
      <div class="page-switcher">
        <em>
          {{ site.data.languages[page.lang].switcher }}:
        </em>
      </div>

      <span class="mr-1">
        <a href="{{ multilingual_event.first.url | relative_url }}" class="{{ multilingual_event.first.lang }}">
          {{ site.data.languages[multilingual_event.first.lang].label }}
        </a>
      </span>

      <hr />
    {% endif %}

    <p>
      HOGAR ALBERGUE JESÚS DE NAZARET, INC © {{ site.data.information.year }}
    </p>

    <div class="pb-1">
      <a href="https://app.forestry.io/sites/heqefiwcnetumg" target="_blank" rel="noreferrer">
        {{ site.data.languages[page.lang].admin_link }}
      </a>
    </div>
  </div>
</footer>

<div class="is-hidden has-background-primary-light has-text-centered is-full-width pt-1 pb-1" id="offline-notification-container">
  {{ site.data.languages[page.lang].offline_message }}
</div>

{% assign needs_link = site.data.information.needs_url[page.lang] %}
{% if (needs_link contains "png") or (needs_link contains "jpg") %}
  <div class="modal" id="needs-modal">
    <div class="modal-background"></div>

    <div class="modal-content">
      <p class="image is-flex-container is-horizontally-centered"">
        <img class="modal-highlight" id="needs-modal-highlight">
      </p>
    </div>

    <button class="modal-close modal-image-close is-large" aria-label="close" id="needs-modal-close"></button>
  </div>
{% endif %}

{% if layout.lazy_load %}
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>
{% endif %}
<script src="{{ '/js/main.js' | relative_url }}" type="text/javascript"></script>
<!-- We use Stripe on every page to process Apple Pay/Google pay from the donate modal -->
<script src="https://js.stripe.com/v3/" defer></script>
<script src="{{ '/js/payment_modal.js' | relative_url }}" type="text/javascript" defer></script>
<script src="{{ '/js/image_modal.js' | relative_url }}" type="text/javascript" async></script>

{% if page.layout == 'landing-page' %}
  <script src="{{ '/js/hosted_fields.js' | relative_url }}" type="text/javascript" defer></script>

  {% if site.data.information.ath_movil.live == true %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" defer></script>
    <script type="text/javascript" defer>
      ATHM_Checkout = {
        env: 'production',
        publicToken: "{{ site.data.information.ath_movil.public_token }}",
        timeout: 600, // Value has to between 120 (2 minutes) and 600 (10 minutes)
        theme: 'btn',
        lang: "{{ page.lang }}",
        total: 1.00,
        tax: null,
        subtotal: 1.00,
        items: [
          {
            'name': 'First Item',
            'description': "{{ site.data.information.give_a_hug.payment_description }}",
            'quantity': 1,
            'price': 1.00,
            'tax': null,
            'metadata': null
          }
        ],
        onCompletedPayment: function (response) {
          window.trackEvent('ath_movil_payment_complete', response);
          // TODO: ping our server to log this donation
          // TODO: show Give a Hug interface
        },
        onCancelledPayment: function () {
          // When the ATH modal/page is dismissed, this method gets called
          window.trackEvent('ath_movil_payment_cancelled');
        },
        onExpiredPayment: function (response) {
          // When the timeout period defined above is done and the payment hasn't
          // been completed, the ATH modal/page closes and this method gets called
          window.trackEvent('ath_movil_payment_attempt_expired');
        }
      };
    </script>
    <script src="https://www.athmovil.com/api/js/v2/athmovilV2.js" type="text/javascript" defer></script>
  {% endif %}
{% endif %}
</body>
</html>
